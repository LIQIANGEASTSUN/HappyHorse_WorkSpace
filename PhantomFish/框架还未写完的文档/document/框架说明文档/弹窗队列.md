# 弹窗队列


进入家园、活动地图、副本等场景，需要弹出来的一系列界面，如：商店界面、礼包界面、激活的活动界面 等等



#### 1.弹窗类型 PopupQueueType

枚举
```csharp
/// <summary>
/// 弹窗队列类型
/// </summary>
public enum PopupQueueType
{

    /// <summary>
    /// 商店弹窗
    /// </summary>
    Shop = 1,

}
```


#### 2.弹窗类接口 IPopupQueue

```csharp
    public interface IPopupQueue
    {

        PopupQueueType PopupQueueType { get; }

        /// <summary>
        /// 判断是否可以触发弹窗
        /// </summary>
        /// <returns></returns>
        bool Check();

        /// <summary>
        /// 调用显示弹窗
        /// </summary>
        void Pop();

    }
```

#### 3.具体弹窗类
继承 IPopupQueue 接口

商店弹窗例子
```csharp
using PFramework;
using UIFrame;

/// <summary>
/// 商店弹窗逻辑
/// </summary>
public class PopupShop : IPopupQueue
{
    public PopupQueueType PopupQueueType 
    {
        get
        {
            return PopupQueueType.Shop;
        }
    }

    /// <summary>
    /// 判断是否弹窗
    /// </summary>
    /// <returns></returns>
    public bool Check()
    {
        // 弹窗队列判断是否需要显示商店
        return true;
    }

    /// <summary>
    /// 调用弹窗
    /// </summary>
    public void Pop()
    {
        // 传递给界面的参数
        // UIOpenSourceType.PopupQueue 打开界面的原因是 弹窗队列
        // 队列附带的参数 PopupQueueType.Shop
        UIShopParameter uIShopParameter = new UIShopParameter(UIOpenSourceType.PopupQueue, PopupQueueType.Shop);
        // 打开商店
        UIManager.Instance.Open(UIPanelType.ShopPanel, uIShopParameter);
    }
}

```


#### 4.注册弹窗类 PopupQueueRegister

```csharp
/// <summary>
/// 注册弹窗类
/// </summary>
public class PopupQueueRegister : SingletonObject<PopupQueueRegister>
{
    public List<Type> GetTypeList()
    {
        List<Type> typeList = new List<Type>();
        typeList.Add(typeof(PopupShop));

        return typeList;
    }

}

```


#### 5.弹窗管理单例类
```csharp
public class PopupQueueController : SingletonObject<PopupQueueController>


// 触发弹窗检测
// 比如进入家园，准备就绪后，调用下面代码
PopupQueueController.Instance.Check();
```


#### 6.单个弹窗完成事件
事件类型     MSG_POPUP_QUEUE_COMPLETE,   // 弹窗队列完成


```csharp
public class UIShopPanel : UIPanelBase
{

    public UIShopPanel()
    {
        View = new UIShopView(this);
        Model = new UIShopModel(this);
    }

    public override void Close()
    {
        // 商店界面关闭的时候，判断如果是从弹窗队列打开的，发个通知
        IUIParameter parameter = Model.UIParameter;
        if (parameter.UIOpenSourceType == UIOpenSourceType.PopupQueue)
        {
            GameNotifycation.Instance.Notify<PopupQueueType>(ENUM_MSG_TYPE.MSG_POPUP_QUEUE_COMPLETE, (PopupQueueType)parameter.SourceData);
        }
    }

}

```
























