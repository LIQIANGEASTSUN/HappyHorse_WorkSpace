# 跳转系统


#### 跳转系统定义了跳转接口：IJumStrategy
#### 每一个继承 IJumStrategy 的类，只能实现一个跳转方式，避免多种跳转方式由一个类实现
#### 好处：通常一些跳转需要多种判断，每种可能都是一个不同的目标类型，拆分开，可以实现各种组合


#### 比如：界面跳转到一个道具，可能有如下几种判断
#### 1：场景内是否有可以生产这个道具的工厂，如果有则跳转
#### 2：场景内是否有可以采集的物品，产出的是这个道具，如果有则跳转
#### 3：商店是否可以购买此道具，如果有则跳转
#### 4：在屏幕上显示一个从屏幕中心向上漂浮的提醒：找不到获取改道具的途径
#### 
#### N 种跳转类型，拆分成 N 个脚本，策划可以以任意优先级或者组合来填这个道具的跳转



#### 跳转枚举类型 JumpType
```chsarp
    /// <summary>
    /// 跳转枚举类型
    /// </summary>
    public enum JumpType
    {
        /// <summary>
        /// 跳转到生产某一个道具的工厂
        /// </summary>
        FactoryProducedItem = 1,

        /// <summary>
        /// 跳转到采集物，采集产出某一个道具
        /// </summary>
        CollectProducedItem = 2,

        /// <summary>
        /// 商店购买某一个道具
        /// </summary>
        ShopBuyItem = 3,

        /// <summary>
        /// 跳转在 UI 上显示一个从屏幕中间向上飘的一个提示文本
        /// </summary>
        ShowUITips = 4,

        /// <summary>
        /// 摄像机聚焦到一个世界坐标
        /// </summary>
        CameraFocusWorldPosition = 10,
    }
```


#### 跳转管理类 AutoJumpController 单利
在构造函数中将 所有的跳转实例化，添加到字典

```chsarp

namespace PFramework
{
    /// <summary>
    /// 各种跳转管理类
    /// 策划可以配置任何组合类型的跳转
    /// </summary>
    public class AutoJumpController : SingletonObject<AutoJumpController>
    {
        private Dictionary<JumpType, IJumStrategy> jumpDic = new Dictionary<JumpType, IJumStrategy>();


        /// <summary>
        /// 从跳转类型获取跳转实例
        /// </summary>
        /// <param name="jumpType"></param>
        /// <returns></returns>
        public IJumStrategy GetJump(JumpType jumpType)


        /// <summary>
        /// 跳转具体方法
        /// </summary>
        /// <param name="jumpTypes">跳转组合数组，按照从前向后的优先级</param>
        /// <param name="parameters">跳转参数</param>
        /// <param name="finishBack">跳转完成后回调</param>
        /// <returns>返回 true 表示找到了跳转目标，可以跳转，返回false 表示找不到跳转目标，无法跳转</returns>
        public bool Jump(JumpType[] jumpTypes, Dictionary<string, object> parameters, Action<bool> finishBack)

        /// <summary>
        /// 跳转具体方法
        /// </summary>
        /// <param name="jumpType">跳转类型</param>
        /// <param name="parameters">跳转参数</param>
        /// <param name="finishBack">跳转完成后回调</param>
        /// <returns>返回 true 表示找到了跳转目标，可以跳转，返回false 表示找不到跳转目标，无法跳转</returns>
        public bool Jump(JumpType jumpType, Dictionary<string, object> parameters, Action<bool> finishBack)

    }
}

```

```chsarp
   public class AutoJumpConfig
    {
        /// <summary>
        /// 配置跳转类型
        /// </summary>
        private static Dictionary<JumpType, Type> jumpDic = new Dictionary<JumpType, Type>() {
            { JumpType.FactoryProducedItem, typeof(JumpCameraFocusWorldPosition)},
            { JumpType.CollectProducedItem, typeof(JumpCollectProducedItem)},
            { JumpType.ShopBuyItem, typeof(JumpShopBuyItem)},
            { JumpType.ShowUITips, typeof(JumpShowUITips)},
            { JumpType.CameraFocusWorldPosition, typeof(JumpCameraFocusWorldPosition)},
        };

        public static IJumStrategy Create(JumpType jumpType)
        {
            if (jumpDic.TryGetValue(jumpType, out var jumStrategy))
            {
                object jump = Activator.CreateInstance(jumStrategy);

                return jump as IJumStrategy;
            }
            return null;
        }
    }
```


调用例子如下
```chsarp
/// <summary>
/// 调用示例
/// </summary>
private void Example()
{
    JumpType[] jumpTypes = new JumpType[] {
    JumpType.FactoryProducedItem,
    JumpType.CollectProducedItem,
    JumpType.ShopBuyItem,
    JumpType.ShowUITips,
    };
    Dictionary<string, object> paramersDic = new Dictionary<string, object>() {
    { "ItemId", "10001"}
    };

    Action<bool> finish = (result) => {

    };
    AutoJumpController.GetInstance().Jump(jumpTypes, paramersDic, finish);
}
```










